<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Lịch sử hoạt động</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
<nav class="navbar navbar-expand-lg ">
    <div class="container-fluid">
        <a class="navbar-brand volunteer" href="#">Volunteer</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
                <li class="nav-item"><a class="nav-link" href="events-list.html">Sự kiện phù hợp</a></li>
                <li class="nav-item"><a class="nav-link" href="help-requests.html">Yêu cầu trợ giúp</a></li>
                <li class="nav-item"><a class="nav-link" href="history.html">Lịch sử</a></li>
                <li class="nav-item"><a class="nav-link" href="notifications-view.html">Thông báo</a></li>
                <li class="nav-item"><a class="nav-link" href="profile.html">Hồ sơ</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container my-4">
    <h2 class="text-center mb-4">Lịch sử hoạt động</h2>
    <table class="table">
        <thead><tr><th>Thời gian</th><th>Nội dung</th><th>Trạng thái</th></tr></thead>
        <tbody id="historyBody"></tbody>
    </table>
</div>

<script>
    (async()=>{
        const userId = 1;
        const [regs, helps] = await Promise.all([
            fetch(`/registrations?volunteerId=${userId}`).then(r=>r.json()),
            fetch(`/helpRequests?volunteerId=${userId}`).then(r=>r.json())
        ]);
        // Xuất sử kiện và helpRequests
        const items = [
            ...regs.map(r=>({ date:r.registrationDate, content:`Tham gia sự kiện #${r.eventId}`, status:r.status })),
            ...helps.map(h=>({ date:h.id, content:`Hỗ trợ yêu cầu "${h.title}"`, status:h.status }))
        ];
        items.sort((a,b)=>new Date(b.date)-new Date(a.date));
        const tb = document.getElementById('historyBody');
        items.forEach(i=>{
            tb.innerHTML += `
      <tr>
        <td>${new Date(i.date).toLocaleString('vi-VN')}</td>
        <td>${i.content}</td>
        <td><span class="badge bg-${i.status==='ATTENDED'||i.status==='COMPLETED'?'success':'warning'}">${i.status}</span></td>
      </tr>`;
        });
    })();
</script>
</body>
</html>

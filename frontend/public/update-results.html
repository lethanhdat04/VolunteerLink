<!DOCTYPE html>
<html lang="vi">
<head><meta charset="UTF-8"><title>Cập nhật kết quả</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"></head>
<body>
<nav><!-- org navbar --></nav>
<div class="container my-4">
    <h2>Cập nhật kết quả</h2>
    <form id="resultForm">
        <div class="mb-3"><label>Mô tả</label><textarea class="form-control" name="resultDescription" rows="4"></textarea></div>
        <button class="btn btn-primary">Lưu</button>
    </form>
</div>
<script>
    const orgId=1, eventId=new URLSearchParams(location.search).get('id');
    document.getElementById('resultForm').onsubmit=async e=>{
        e.preventDefault();
        const eObj=await fetch(`/events/${eventId}`).then(r=>r.json());
        if(eObj.organizationId!==orgId){alert('Không quyền');return;}
        const desc=new FormData(e.target).get('resultDescription');
        await fetch(`/events/${eventId}`,{method:'PATCH',headers:{'Content-Type':'application/json'},
            body:JSON.stringify({resultDescription:desc,status:'COMPLETED'})});
        alert('Đã lưu');location.href='manage-events.html';
    };
</script>
</body>
</html>

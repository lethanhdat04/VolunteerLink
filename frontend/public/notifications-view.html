<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Thông báo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>.alert{cursor:pointer;}</style>
</head>
<body>
<nav class="navbar navbar-expand-lg ">
    <div class="container-fluid">
        <a class="navbar-brand volunteer" href="#">Volunteer</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
                <li class="nav-item"><a class="nav-link" href="events-list.html">Sự kiện phù hợp</a></li>
                <li class="nav-item"><a class="nav-link" href="help-requests.html">Yêu cầu trợ giúp</a></li>
                <li class="nav-item"><a class="nav-link" href="history.html">Lịch sử</a></li>
                <li class="nav-item"><a class="nav-link" href="notifications-view.html">Thông báo</a></li>
                <li class="nav-item"><a class="nav-link" href="profile.html">Hồ sơ</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container my-4">
    <h2 class="text-center mb-4">Thông báo của bạn</h2>
    <div id="notifList"></div>
</div>

<script>
    (async()=>{
        const notifs = await fetch('/notifications?recipientId=1').then(r=>r.json());
        const list   = document.getElementById('notifList');
        if(!notifs.length){ list.innerHTML='<p>Không có thông báo.</p>'; return; }
        notifs.forEach(n=>{
            const div = document.createElement('div');
            div.className = `alert ${n.status==='UNREAD'?'alert-warning':'alert-success'}`;
            div.innerHTML = n.content;
            div.onclick = async ()=>{
                if(n.status==='UNREAD'){
                    await fetch(`/notifications/${n.id}`, {
                        method:'PATCH',headers:{'Content-Type':'application/json'},
                        body: JSON.stringify({status:'READ'})
                    });
                    div.classList.replace('alert-warning','alert-success');
                }
            };
            list.appendChild(div);
        });
    })();
</script>
</body>
</html>
